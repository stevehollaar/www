var AppModel=Backbone.Model.extend({defaults:{page:null},setPage:function(e,i){i=i||{},this.set({page:e},i),i.silent||(App.router.navigate(e),ga&&ga("send","pageview","/"+e))}}),NavView=Backbone.View.extend({app:null,events:{"click .page:not(.active)":"navClickEvt_"},initialize:function(e){this.app=e.app;var i=this.$el.find(".page.active").data("page");this.app.model.set("page",i),this.listenTo(this.app.model,"change:page",this.changePageEvt_.bind(this))},navClickEvt_:function(e){var i=$(e.currentTarget);this.app.model.setPage(i.data("page"))},changePageEvt_:function(){var e=this.app.model.get("page"),i=this.$el.find('.page[data-page="'+e+'"]');this.$el.find(".page").removeClass("active"),i.addClass("active")}}),PageDescriptionView=Backbone.View.extend({app:null,initialize:function(e){this.app=e.app,this.listenTo(this.app.model,"change:page",this.changePageEvt_.bind(this))},changePageEvt_:function(){var e=this.app.model.get("page");this.$el.find(".page-description").removeClass("active"),this.$el.find(".page-description."+e).addClass("active")}}),HeaderView=Backbone.View.extend({navView_:null,app:null,initialize:function(e){this.app=e.app,this.navView_=new NavView({el:this.el.querySelector("nav"),app:this.app}),this.pageDescriptionView_=new PageDescriptionView({el:this.el.querySelector(".page-description-container"),app:this.app})},render:function(){this.navView_.render(),this.pageDescriptionView_.render()}}),PageView=Backbone.View.extend({activate:function(){this.$el.addClass("active")},deactivate:function(){this.$el.removeClass("active")}}),DashboardHeaderView=Backbone.View.extend({activeTimeFrame_:null,events:{"click .timeframe button":"changeTimeFrame_"},initialize:function(){this.activeTimeFrame_=DashboardHeaderView.TIMEFRAMES.day},render:function(){},changeTimeFrame_:function(e){var i=$(e.currentTarget);this.$el.find(".timeframe button").removeClass("active"),i.addClass("active"),this.trigger("changeTimeFrame",i.data("timeframe"))}});DashboardHeaderView.TIMEFRAMES={day:0,week:1,month:2,year:3,custom:4};var DashboardSectionView=Backbone.View.extend({expanded_:!1,initialize:function(){this.listenTo(this.colection,"updated",this.render.bind(this))},render:function(){this.el.innerHTML=Templates.DashboardSection()}}),FoursquareCheckinsView=DashboardSectionView.extend({initialize:function(){this.listenTo(this.collection,"updated",this.render.bind(this))},render:function(){this.el.innerHTML=Templates.FoursquareCheckins({checkins:this.collection.toJSON()})}}),CurrentTimeView=Backbone.View.extend({initialize:function(){setInterval(this.render.bind(this),10)},render:function(){this.el.innerHTML=moment().format("h:mm:ss.Sa")}}),DashboardPageView=PageView.extend({dashboardHeaderView_:null,foursquareCheckinsView_:null,currentTimeView_:null,initialize:function(){this.dashboardHeaderView_=new DashboardHeaderView({el:this.el.querySelector("header")}),this.currentTimeView_=new CurrentTimeView({el:this.el.querySelector(".current-time")}),this.dashboardHeaderView_.on("changeTimeFrame",function(e){console.log(e)});var e=this.el.querySelector(".foursquare-checkins");e&&(this.foursquareCheckinsView_=new FoursquareCheckinsView({el:e,collection:this.model.get("foursquareCheckins")}))},render:function(){}}),HacksPageView=PageView.extend({}),ResumePageView=PageView.extend({}),FoursquareCheckinModel=Backbone.Model.extend({"default":{type:null,isMayor:null,timeZoneOffset:null,venue:null},initialize:function(){}}),FoursquareCheckinCollection=Backbone.Collection.extend({model:FoursquareCheckinModel,url:"/api/checkins",initialize:function(){this.fetch()},parse:function(e){this.set(e),this.trigger("updated")}}),DashboardModel=Backbone.Model.extend({defaults:{foursquareCheckins:null},initialize:function(){this.set("foursquareCheckins",new FoursquareCheckinCollection)}}),MainView=Backbone.View.extend({app:null,pageViews_:null,initialize:function(e){this.app=e.app,this.pageViews_={dashboard:new DashboardPageView({el:this.el.querySelector("section.dashboard"),model:new DashboardModel}),hacks:new HacksPageView({el:this.el.querySelector("section.hacks")}),resume:new ResumePageView({el:this.el.querySelector("section.resume")})},this.listenTo(this.app.model,"change:page",this.render.bind(this))},render:function(){_.values(this.pageViews_).forEach(function(e){e.render()});var e=this.pageViews_[this.app.model.get("page")];this.activatePageView_(e)},activatePageView_:function(e){this.deactivateAllPages_(),e.activate()},deactivateAllPages_:function(){_.values(this.pageViews_).forEach(function(e){e.deactivate()})}}),AppView=Backbone.View.extend({headerView_:null,mainView_:null,model:null,initialize:function(){this.headerView_=new HeaderView({el:this.el.querySelector("header"),app:this}),this.mainView_=new MainView({el:this.el.querySelector("main"),app:this})},render:function(){this.headerView_.render(),this.mainView_.render()},activate:function(e){this.mainView_.activate(e)}}),Router=Backbone.Router.extend({routes:{"":"dashboard",dashboard:"dashboard","dashboard/":"dashboard",hacks:"hacks",resume:"resume"},dashboard:function(){App.model.set("page","dashboard")},hacks:function(){App.model.set("page","hacks")},resume:function(){App.model.set("page","resume")}}),App;$(function(){App=new AppView({el:document.querySelector("body"),model:new AppModel}),FastClick.attach(document.body),App.router=new Router,Backbone.history.start({pushState:!0,hashChange:!1}),App.render()});var dateFormats={"short":"DD MMMM - YYYY","long":"ddd MMM DD, YYYY h:mma"};Handlebars.registerHelper("formatDate",function(e,i){return f=dateFormats[i],moment(e).format(f)}),Handlebars.registerHelper("formatSecondsDate",function(e,i){return f=dateFormats[i],moment(1e3*e).format(f)});